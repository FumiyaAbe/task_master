<div class="mx-auto max-w-4xl px-4 py-6">
  <!-- ヘッダ（タイトル + 新規作成） -->
  <div class="page-head mb-4">
    <h1 class="text-2xl font-bold">Tasks</h1>
    <% if user_signed_in? %>
      <%= link_to "新規タスク", new_task_path, class: "btn-accent" %>
    <% end %>
  </div>

  <% if @tasks.any? %>
    <!-- カードグリッド -->
    <div class="grid grid-cols-1 gap-3 md:grid-cols-2">
      <% @tasks.each do |task| %>
        <div class="card">
          <div class="flex items-start justify-between gap-3">
            <div>
              <%= link_to task.title, task_path(task), class: "card-title" %>

              <!-- ステータス / 優先度 バッジ -->
              <div class="mt-1 space-x-2">
                <% if task.respond_to?(:status) && task.status.present? %>
                  <% st = task.status.to_s %>
                  <span class="badge <%= st.downcase == 'done' ? 'badge-green' : 'badge-indigo' %>">
                    状態: <%= st %>
                  </span>
                <% end %>

                <% if task.respond_to?(:priority) && task.priority.present? %>
                  <% pr = task.priority.to_s %>
                  <% pr_class =
                        case pr.downcase
                        when 'high', 'urgent' then 'badge-red'
                        when 'low'            then 'badge-gray'
                        else                        'badge-indigo'
                        end %>
                  <span class="badge <%= pr_class %>">
                    優先度: <%= pr %>
                  </span>
                <% end %>
              </div>
            </div>

            <%= link_to "詳細", task_path(task), class: "btn-ghost" %>
          </div>

          <% if task.respond_to?(:due_at) && task.due_at.present? %>
            <div class="card-meta mt-3">
              期限: <%= l(task.due_at, format: :long) rescue task.due_at.to_s %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <!-- 空状態 -->
    <div class="card">
      <p class="text-sm text-gray-600">まだタスクがありません。</p>
      <% if user_signed_in? %>
        <div class="mt-3">
          <%= link_to "最初のタスクを作成", new_task_path, class: "btn-accent" %>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
