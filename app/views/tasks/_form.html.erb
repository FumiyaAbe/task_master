<%= simple_form_for(@task, wrapper: :default) do |f| %>
  <!-- ✨ エラーサマリー（共通パーシャル） -->
  <%= render "shared/error_summary", resource: @task %>

  <%# datetime-local 用の値をHTML5形式へ整形（期限がある場合） %>
  <% due_val = @task.respond_to?(:due_at) ? @task.due_at&.strftime("%Y-%m-%dT%H:%M") : nil %>

  <div class="card space-y-5">
    <!-- タイトル（必須・最大100） -->
    <%= f.input :title,
                label: "タイトル",
                required: true,
                input_html: { placeholder: "例）仕様確認タスク", maxlength: 100 } %>

    <!-- ステータス / 優先度 -->
    <div class="grid gap-4 md:grid-cols-2">
      <%= f.input :status,
                  as: :select,
                  label: "状態",
                  collection: (Task.respond_to?(:statuses) ? Task.statuses.keys : %w[todo doing done]),
                  prompt: "選択してください" %>

      <%= f.input :priority,
                  as: :select,
                  label: "優先度",
                  collection: (Task.respond_to?(:priorities) ? Task.priorities.keys : %w[low medium high urgent]),
                  prompt: "選択してください" %>
    </div>

    <!-- 期限 -->
    <% if @task.respond_to?(:due_at) %>
      <%= f.input :due_at,
                  as: :string,
                  label: "期限",
                  input_html: { type: "datetime-local", value: due_val, step: 60, autocomplete: "off" } %>
    <% end %>

    <!-- 説明（最大2000） -->
    <%= f.input :body,
                as: :text,
                label: "説明",
                input_html: { placeholder: "補足があれば記入", maxlength: 2000 } %>

    <!-- アクション -->
    <div class="flex items-center justify-end gap-2">
      <%= link_to "一覧に戻る", tasks_path, class: "btn-ghost" %>
      <%= f.button :submit, (@task.persisted? ? "更新する" : "作成する"), class: "btn-main" %>
    </div>
  </div>
<% end %>
